<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UAScoin Clicker Game</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }

    header {
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      display: flex;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      width: 100%;
    }

    header button {
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      padding: 10px;
      cursor: pointer;
    }

    .section {
      display: none;
      padding: 20px;
    }

    .active {
      display: block;
    }

    .coin {
      width: 120px;
      height: 120px;
      margin: 40px auto;
      animation: bounce 0.6s infinite alternate;
    }

    @keyframes bounce {
      to {
        transform: scale(1.05) translateY(-10px);
      }
    }

    .skin-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
    }

    .skin-card button {
      margin: 5px;
      padding: 6px 12px;
      border-radius: 6px;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
    }

    .center {
      text-align: center;
    }
  </style>
</head>
<body>

<div class="section active" id="earn">
  <div class="center">
    <h2>Taps: <span id="tap-count">0</span></h2>
    <img id="coin-img" class="coin" src="bronze_coin.png" onclick="handleTap()" alt="Coin"/>
  </div>
</div>

<div class="section" id="upgrades">
  <h3>Upgrade Section</h3>
  <p>Coming soon...</p>
</div>

<div class="section" id="skins">
  <h3>Buy Coin Skins</h3>
  <div id="skins-container"></div>
</div>

<div class="section" id="leaderboard">
  <h3>Leaderboard</h3>
  <p>Coming soon...</p>
</div>

<div class="section" id="referrals">
  <h3>Referrals</h3>
  <p>Invite friends & earn bonuses! (Coming soon...)</p>
</div>

<header>
  <button onclick="switchSection('earn')">Earn</button>
  <button onclick="switchSection('upgrades')">Upgrades</button>
  <button onclick="switchSection('skins')">Skins</button>
  <button onclick="switchSection('leaderboard')">Leaderboard</button>
  <button onclick="switchSection('referrals')">Referrals</button>
</header>

<script>
  const leagueLevels = [
    { name: "bronze", taps: 0 },
    { name: "silver", taps: 10000 },
    { name: "gold", taps: 500000 },
    { name: "diamond", taps: 1000000 },
    { name: "platinum", taps: 50000000 },
    { name: "adamantium", taps: 100000000 },
    { name: "vibranium", taps: 200000000 },
  ];

  let taps = parseInt(localStorage.getItem("taps") || 0);
  let ownedSkins = JSON.parse(localStorage.getItem("ownedSkins") || "[]");
  let currentSkin = localStorage.getItem("currentSkin") || null;

  const tapDisplay = document.getElementById("tap-count");
  const coinImg = document.getElementById("coin-img");

  const coinSkins = [
    { id: 1, name: "Bronze Skin", bonus: 1.1, priceUSDT: 0.5, pricePi: 0.1 },
    { id: 2, name: "Silver Skin", bonus: 1.2, priceUSDT: 1, pricePi: 0.2 },
    { id: 3, name: "Gold Skin", bonus: 1.3, priceUSDT: 2, pricePi: 0.3 },
  ];

  function switchSection(sectionId) {
    document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
    document.getElementById(sectionId).classList.add("active");
  }

  function getLeagueSkin() {
    let skin = "bronze_coin.png";
    for (let i = leagueLevels.length - 1; i >= 0; i--) {
      if (taps >= leagueLevels[i].taps) {
        skin = `${leagueLevels[i].name}_coin.png`;
        break;
      }
    }
    return skin;
  }

  function updateCoinImage() {
    const skinPath = getLeagueSkin();
    coinImg.src = skinPath;
  }

  function handleTap() {
    let bonus = 1;
    const skin = coinSkins.find(s => s.id == currentSkin);
    if (skin) bonus = skin.bonus;
    taps += bonus;
    localStorage.setItem("taps", taps);
    tapDisplay.textContent = Math.floor(taps);
    updateCoinImage();
  }

  function renderSkins() {
    const container = document.getElementById("skins-container");
    container.innerHTML = "";
    coinSkins.forEach((skin) => {
      const owned = ownedSkins.includes(skin.id);
      container.innerHTML += `
        <div class="skin-card">
          <h4>${skin.name}</h4>
          <p>Bonus: x${skin.bonus}</p>
          ${owned ? `<button onclick="selectSkin(${skin.id})">Select</button>` : `
            <button onclick="buySkinWithUSDT(${skin.id}, ${skin.priceUSDT})">Buy with USDT (${skin.priceUSDT})</button>
            <button onclick="buySkinWithPi(${skin.id}, ${skin.pricePi})">Buy with Pi (${skin.pricePi})</button>
          `}
        </div>
      `;
    });
  }

  function selectSkin(skinId) {
    currentSkin = skinId;
    localStorage.setItem("currentSkin", skinId);
    alert("Skin selected! Tap bonus applied.");
  }

  function unlockSkin(skinId) {
    if (!ownedSkins.includes(skinId)) {
      ownedSkins.push(skinId);
      localStorage.setItem("ownedSkins", JSON.stringify(ownedSkins));
      renderSkins();
    }
  }

  function buySkinWithUSDT(skinId, amountUSDT) {
    alert(`Redirect to pay ${amountUSDT} USDT...`);
    unlockSkin(skinId);
  }

  async function buySkinWithPi(skinId, amountPi) {
    const paymentData = {
      amount: amountPi,
      memo: `Purchase skin ${skinId}`,
      metadata: { skinId },
    };

    Pi.init({ version: '2.0' });

    Pi.createPayment(paymentData, {
      onReadyForServerApproval: async (paymentId) => {
        await fetch('/approve-payment', {
          method: 'POST',
          body: JSON.stringify({ paymentId }),
          headers: { 'Content-Type': 'application/json' }
        });
      },
      onReadyForServerCompletion: async (paymentId, txid) => {
        await fetch('/complete-payment', {
          method: 'POST',
          body: JSON.stringify({ paymentId, txid }),
          headers: { 'Content-Type': 'application/json' }
        });
        unlockSkin(skinId);
      },
      onCancel: (paymentId) => alert("Payment cancelled."),
      onError: (err) => console.error("Payment error:", err),
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    renderSkins();
    updateCoinImage();
    tapDisplay.textContent = Math.floor(taps);
  });
</script>
</body>
</html>
