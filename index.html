<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UAScoin Tap Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            touch-action: manipulation;
            font-family: Arial, sans-serif;
        }

        .score-display {
            color: #FFD700;
            font-size: 6vw;
            margin: 4vh 0;
            text-shadow: 0 0 15px rgba(255,215,0,0.5);
            position: fixed;
            top: 0;
            z-index: 10;
        }

        .energy-bar {
            width: 80vw;
            height: 3vh;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            position: fixed;
            bottom: 5vh;
            overflow: hidden;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            transition: width 0.3s ease;
            width: 100%;
        }

        .energy-text {
            position: absolute;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 2vh;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            top: 50%;
            transform: translateY(-50%);
        }

        .game-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
        }

        canvas {
            width: 70vmin;
            height: 70vmin;
            max-width: 400px;
            max-height: 400px;
            touch-action: none;
        }
    </style>
</head>
<body>
    <div class="score-display">UAScoins: <span id="scoreDisplay">0</span></div>
    
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="energy-bar">
        <div class="energy-fill" id="energyFill"></div>
        <div class="energy-text" id="energyText">Energy: 1000/1000</div>
    </div>

    <script>
        // ======================
        // üéÆ GAME INITIALIZATION
        // ======================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        const baseSize = 300;
        let coinRotation = 0;
        let lastTimestamp = 0;

        // High DPI Setup
        canvas.width = baseSize * dpr;
        canvas.height = baseSize * dpr;
        canvas.style.width = baseSize + 'px';
        canvas.style.height = baseSize + 'px';
        ctx.scale(dpr, dpr);

        // ======================
        // üíæ USER DATA MANAGEMENT
        // ======================
        let userData = {
            score: 0,
            energy: 1000,
            maxEnergy: 1000,
            lastUpdate: Date.now()
        };

        function loadData() {
            const saved = localStorage.getItem('uascoinData');
            if(saved) {
                const parsed = JSON.parse(saved);
                userData.score = parsed.score || 0;
                userData.energy = parsed.energy || 1000;
                userData.maxEnergy = parsed.maxEnergy || 1000;
                userData.lastUpdate = parsed.lastUpdate || Date.now();
                updateEnergy();
            }
        }

        function saveData() {
            userData.lastUpdate = Date.now();
            localStorage.setItem('uascoinData', JSON.stringify(userData));
        }

        // ======================
        // ‚ö° ENERGY SYSTEM
        // ======================
        function updateEnergy() {
            const now = Date.now();
            const timeDiff = now - userData.lastUpdate;
            const minutesPassed = timeDiff / (1000 * 60);
            const energyGain = Math.floor(minutesPassed / 3);
            
            if(energyGain > 0) {
                userData.energy = Math.min(
                    userData.maxEnergy,
                    userData.energy + energyGain
                );
                userData.lastUpdate = now;
                saveData();
            }
        }

        function useEnergy(amount = 1) {
            if(userData.energy >= amount) {
                userData.energy -= amount;
                return true;
            }
            return false;
        }

        // ======================
        // üé® GAME VISUALS
        // ======================
        const particles = [];
        const stars = Array.from({length: 100}, () => ({
            x: Math.random() * baseSize,
            y: Math.random() * baseSize,
            size: Math.random() * 1.5,
            speed: Math.random() * 0.1 + 0.05,
            alpha: Math.random() * 0.6 + 0.2
        }));

        // Create coin image
        const coinImg = new Image();
        coinImg.onload = () => {
            // Redraw when image loads
            if (typeof gameLoop === 'function') gameLoop();
        };
        coinImg.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI0ZGREMwMCIgc3Ryb2tlPSIjQ0M5RTAwIiBzdHJva2Utd2lkdGg9IjUiLz48cGF0aCBkPSJNNTAgMTBDNzcuNiAxMCAxMCAyNy42IDEwIDUwczY3LjYgNDAgNDAgNDAgNDAtMTcuNiA0MC00MFMyMi40IDEwIDUwIDEweiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjRkZGRkZGIiBzdHJva2Utd2lkdGg9IjIiLz48dGV4dCB4PSI1MCIgeT0iNTUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzAwMCI+VUFTQ09JTjwvdGV4dD48L3N2Zz4=';

        // Ambient particles
        const ambientParticles = Array.from({length: 50}, () => ({
            x: Math.random() * baseSize,
            y: Math.random() * baseSize,
            size: Math.random() * 3 + 1,
            color: `hsla(${Math.random() * 360}, 70%, 50%, ${Math.random() * 0.3 + 0.1})`,
            speedX: (Math.random() - 0.5) * 0.5,
            speedY: (Math.random() - 0.5) * 0.5,
            life: Math.random() * 0.5 + 0.5
        }));

        function drawBackground() {
            // Gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, baseSize);
            gradient.addColorStop(0, '#0a0a1a');
            gradient.addColorStop(1, '#1a1a3a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, baseSize, baseSize);

            // Stars
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                star.y = (star.y + star.speed) % baseSize;
                ctx.globalAlpha = star.alpha;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        }

        function drawCoin() {
            ctx.save();
            ctx.translate(baseSize/2, baseSize/2);
            
            // Pulsing animation
            const pulse = 1 + Math.sin(Date.now() / 300) * 0.05;
            ctx.scale(pulse, pulse);
            
            // Rotation
            coinRotation += 0.02;
            ctx.rotate(coinRotation);
            
            // Draw coin (image or fallback)
            if(coinImg.complete) {
                ctx.drawImage(coinImg, -45, -45, 90, 90);
            } else {
                // Fallback circle
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(0, 0, 45, 0, Math.PI * 2);
                ctx.fill();
                
                // Fallback text
                ctx.fillStyle = '#000';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('UASCOIN', 0, 5);
            }
            
            ctx.restore();
        }

        function createParticles(x, y) {
            for(let i = 0; i < 15; i++) {
                particles.push({
                    x, y,
                    size: Math.random() * 6 + 3,
                    color: `hsl(${Math.random() * 60 + 30}, 100%, 50%)`,
                    speedX: (Math.random() - 0.5) * 8,
                    speedY: (Math.random() - 0.5) * 8,
                    life: 1
                });
            }
        }

        function updateParticles() {
            for(let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.speedX;
                p.y += p.speedY;
                p.life -= 0.02;
                p.size *= 0.96;
                
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                
                if(p.life <= 0) particles.splice(i, 1);
            }
            ctx.globalAlpha = 1;
        }

        function updateAmbientParticles() {
            ambientParticles.forEach(p => {
                p.x = (p.x + p.speedX + baseSize) % baseSize;
                p.y = (p.y + p.speedY + baseSize) % baseSize;
                
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        }

        // ======================
        // üïπÔ∏è GAME LOOP
        // ======================
        function gameLoop(timestamp) {
            // Clear with fade effect
            ctx.fillStyle = 'rgba(10, 10, 20, 0.2)';
            ctx.fillRect(0, 0, baseSize, baseSize);
            
            // Update energy every second
            if(!lastTimestamp || timestamp - lastTimestamp >= 1000) {
                updateEnergy();
                lastTimestamp = timestamp;
            }
            
            // Draw all elements
            drawBackground();
            updateAmbientParticles();
            drawCoin();
            updateParticles();
            
            // Update UI
            document.getElementById('scoreDisplay').textContent = Math.floor(userData.score);
            const energyPercent = (userData.energy / userData.maxEnergy) * 100;
            document.getElementById('energyFill').style.width = `${energyPercent}%`;
            document.getElementById('energyText').textContent = 
                `Energy: ${userData.energy}/${userData.maxEnergy}`;
            
            requestAnimationFrame(gameLoop);
        }

        // ======================
        // üëÜ INPUT HANDLING
        // ======================
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scale = baseSize / rect.width;
            const x = (e.clientX - rect.left) * scale;
            const y = (e.clientY - rect.top) * scale;
            
            // Check if click was within coin
            const dx = x - baseSize/2;
            const dy = y - baseSize/2;
            const distance = Math.sqrt(dx*dx + dy*dy);
            
            if(distance < 45) {
                if(!useEnergy(1)) {
                    alert("Not enough energy! Wait for regeneration.");
                    return;
                }
                
                // Score increases with bonus based on current score
                const bonus = Math.floor(userData.score / 100);
                userData.score += 1 + bonus;
                
                createParticles(x, y);
                saveData();
            }
        });

        // ======================
        // üöÄ INITIALIZE
        // ======================
        loadData();
        requestAnimationFrame(gameLoop);

        // Save on exit
        window.addEventListener('beforeunload', saveData);
    </script>
</body>
</html>
